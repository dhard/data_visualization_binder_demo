---
title: "Dmonstration of Data Visualization and Integration Workflows in RStudio"
author: "YourFirstName YourLastName and David H. Ardell"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
  pdf_document:
    number_sections: yes
    toc: yes
  word_document:
    toc: yes
params:
  version: 1
editor_options:
  chunk_output_type: inline
urlcolor: blue
linkcolor: red
---
```{r setup, include=FALSE, cache=F, message=F, warning=F, results="hide"}
knitr::opts_chunk$set(echo=TRUE,cache=TRUE,warning=FALSE, message=FALSE)
q <- 0 ## initialize question counter
ans <- list() ## to check answers; list() is an OOP-like constructor for lists
```


# Preface

## Version

This is version `r params$version`. 

## About this Document

The purpose of this document is to demonstrate how easy it is to share web-based reproducible authoring and computing data scientific workflows written in [RMarkdown/Quarto](http://rmarkdown.rstudio.com) with [RStudio/Posit](https://www.rstudio.com) using the [rocker/geospatial](https://hub.docker.com/r/rocker/geospatial)
image template with [mybinder.org](https://mybinder.org). Docker images created with Binder can be served to students by any JupyterHub (such as UC Merced's 2i2c hub).

This document demonstrates reproducible computational data scientific authoring and is based on actual assigned problem sets used for data science and computing labs in BIO 182: Bioinformatics and QSB 282: Graduate Bioinformatics at UC Merced taught by Prof. David H. Ardell. 

# Demonstration

## Data Visualization Techniques

### Integrating, Reshaping and Visualizing Incidence of Babynames Over Decades with Euler Diagrams

For many years the U.S. Social Security Administration has published data on [Popular Baby Names by Decade](https://www.ssa.gov/OACT/babynames/decades/) for  decades from the 1880s to the 2010s. There are 14 decades of data encompassing the top 200 boy's and girl's names from each decade, and this data has been used to study cultural evolution trends. Since 2009, Bioinformatics students at U.C. Merced have trained on autimated web-scraping, integrating and analyzing baby names data.

In this problem solution I demonstrate aggregating the incidence of all names in the data over all of the decades and visualizing the incidenece/sharing of names over decades using Venn/Euler diagrams. 

```{bash download, eval=FALSE}
perl -e 'for(0..13) {$Y=1880 + ($_*10); system "wget \"https://www.ssa.gov/OACT/babynames/decades/names${Y}s.html\"\n"}'


1. Selects only the columns corresponding to the decades `1880 1910 1940 1970 2000` 
1. Visualizes the incidence of names over these five decades in an Euler diagram that shows the numbers of names in each overlap by passing the parameter `quantities=TRUE` to the `plot()` function.

```{r}
library(tidyverse)
library(eulerr)
babynames <- read_tsv("babynames_all.txt",col_names=c("decade","rank","boyname","numboys","girlname","numgirls"))
as_tibble(babynames) %>% select(decade,boyname,girlname) %>% gather(key="type",value="name",boyname,girlname) %>% select(decade,name) %>% table() %>% t() -> names.table
decades <- c("1880","1910","1940","1970","2000")
plot(euler(as.data.frame.matrix(names.table[,decades])),quantities=TRUE,main="Sharing of Top 200 U.S. Babynames Across Five Decades")
```


### Scatterplots using `ggplot2`

**Question `r q<-q+1;q`:  Graph `Sepal.Width` against `Sepal.Length` in the `iris` dataset. Color points by `Species` and make their areas ("sizes") proportional to `Petal.Width`. Use an alpha of 0.5 and jitter height and width parameters of 0.02 to deal with overplotting in the data.**

Answer `r q`:
```{r}
library(pals)
ggplot(iris, aes(Sepal.Length, Sepal.Width, alpha=0.5, color = Species, size=Petal.Width)) +
  geom_jitter(height=0.02,width=0.02) + 
  labs(title="Sepal Width and Petal Width of Three Species of Iris against Sepal Length",x="Sepal Length",y="Sepal Width",subtitle="Anderson (1935). The Irises of the Gaspe Peninsula, Bulletin of the American Iris Society 59:2") +
  scale_color_manual(values=okabe(4)[c(3,2,4)])
```


### Visualizing Overlapping Densities using `ggplot2`

**Question `r q<-q+1;q`:  Write exactly one expression in R that evaluates to use `ggplot()` `geom_density()` and the colorblind-safe Okabe color scale to compute and render a color-blind-friendly density plot of Sepal Lengths in the `iris` data colored by species that uses transparency to see overlapping densities, adds the x-label "Sepal Length", and adds the title "Sepal Lengths of Irises by Species".**

Answer `r q`:
```{r}
ggplot(iris, aes(x = Sepal.Length, fill = Species)) + geom_density(alpha=0.3) + xlab("Sepal Length") + labs(title="Distributions of Sepal Lengths in Three Species of Iris",subtitle="Demonstrates Okabe Colorblind-safe Palette") + scale_fill_manual(values=okabe(4)[c(3,2,4)])
```

### Clean and Plot Mammals Data

Read about the tab-delimited dataset of [Life history characteristics of placental non-volant mammals](https://esajournals.onlinelibrary.wiley.com/doi/10.1890/02-9002). Download the data from its [archived location at FigShare](https://figshare.com/articles/dataset/Data_Paper_Data_Paper/3523109?backTo=/collections/LIFE_HISTORY_CHARACTERISTICS_OF_PLACENTAL_NONVOLANT_MAMMALS/3297992) in your working directory alongside this Rmd file.


Answer `r q`:
```{r }
mammals <- read.table("Mammal_lifehistories_v2.txt",sep="\t",header=TRUE, na.strings = c("-999.00","-999"))
mammals <- mammals[1:1440,]
data <- mammals[,c(1,5,11)]
data2 <- data[apply(data,1,function(x)!any(is.na(x))),] ## remove rows with NA
names(data2) <- c("order","mass","lifespan")
ggplot(data2, aes(log(mass), log(lifespan), alpha=0.4, color = order)) +
  geom_jitter(height=0.01,width=0.01) + 
  labs(title="Lifespan as a Function of Body Mass in Placental Non-Flying Mammals",x="Body Mass (g)",y="Lifespan (mo.)",subtitle="Data from Ernest (2003). Ecology 84:3402") 
```

## Finite State Machines (FSMs)

These exercises demonstrate how to use hashing through `digest` to allow students to check their work without exposing correct answers.

### State, Input and Output Sequences

Find in the lecture notes the FSM with three states  $\{A,B,C\}$ that takes as its input symbol set $\{x,y,z\}$ and as its output symbol set $\{u,v,w,x\}$. 

Suppose that this symbol sequence data is input to the machine: input <- "`r input<-"xxxyyyzzzxxxyyyzzzxxx";input`". 

**Question `r q<-q+1;q`:  What output symbol sequence will the machine produce in response to this input?**

Please put your answer inside the inner-most double-quotation marks `""` in the line below under "Answer."
Your answer may be shorter than the input sequence because some input symbols are ignored.

Answer `r q`: ans[[`r q`]] <- "`r ans <- append(ans,"uuuxxxvvvxwww");tail(ans,1)`"

**Question `r q<-q+1;q`:  What state sequence will the machine transition through in response to this input?** 

Include the starting state A before the first input, and include every state the machine is in after every input symbol, including those that produce no output. Your answer should be one character longer than the input sequence.

Answer `r q`: ans[[`r q`]] <- "`r ans <- append(ans,"AAAAAAABABBBBCCCCCCCCC");tail(ans,1)`"

Modify the following code chunk to check your work, using the `nchar()` function in R. 

On knitting, the boolean expressions in the following code chunk should evaluate to `TRUE` if you answered correctly.

```{r}
nchar(input) == 21
nchar(ans[[1]]) == 13
digest::digest2int(ans[[1]],seed=42) == -1434161340
nchar(ans[[2]]) == 22
digest::digest2int(ans[[2]],seed=42) == 1183361337
```